"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.JwtTokenWithX5UKeyProcessor=void 0;const common_1=require("@nestjs/common"),jose=require("jose"),jwt_token_processor_1=require("./jwt.token.processor");class JwtTokenWithX5UKeyProcessor extends jwt_token_processor_1.JwtTokenProcessor{constructor(e,o,t){super(new common_1.Logger(JwtTokenWithX5UKeyProcessor.name)),this.key=e,this.httpClient=o,this.x5uUrl=t}async validateToken(e){this.log.debug("Call validateToken");const[o,t]=this.parse(e);if("None"===o.alg)return t;const s=o.x5u;this.log.debug(`Loading key from url ${s}`);const r=await this.httpClient.loadPlain(s),n=await jose.importX509(r,"RS256");return jose.jwtVerify(e,n)}async createToken(e){this.log.debug("Call createToken");const o=await jose.importPKCS8(this.key,"RS256");return new jose.SignJWT(e).setProtectedHeader({typ:"JWT",alg:"RS256",x5u:this.x5uUrl}).sign(o)}}exports.JwtTokenWithX5UKeyProcessor=JwtTokenWithX5UKeyProcessor;