"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.JwtTokenWithX5CKeyProcessor=void 0;const common_1=require("@nestjs/common"),jose=require("jose"),jwt_token_processor_1=require("./jwt.token.processor");class JwtTokenWithX5CKeyProcessor extends jwt_token_processor_1.JwtTokenProcessor{constructor(e){super(new common_1.Logger(JwtTokenWithX5CKeyProcessor.name)),this.key=e}async validateToken(e){this.log.debug("Call validateToken");const[o,t]=this.parse(e);if("None"===o.alg)return t;const s=o.x5c,r=await jose.importPKCS8(s[0],"RS256");return this.log.debug(`Taking keys from ${JSON.stringify(s)}`),await jose.jwtVerify(e,r)}async createToken(e){this.log.debug("Call createToken");const o=await jose.importPKCS8(this.key,"RS256");return new jose.SignJWT(e).setProtectedHeader({typ:"JWT",alg:"RS256",x5c:[this.key]}).sign(o)}}exports.JwtTokenWithX5CKeyProcessor=JwtTokenWithX5CKeyProcessor;